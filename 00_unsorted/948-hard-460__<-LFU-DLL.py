# https://leetcode.com/problems/lfu-cache/description/
import time
from dataclasses import dataclass
from typing import Optional


@dataclass(slots=True)
class Node:                                         # Doubly_Linked_List
    key:    int
    val:    int     # value
    cnt:    int     # count
    nxt:    Optional['Node'] = None
    prv:    Optional['Node'] = None

    def pop(self) -> Optional['Node']:              #      â”Œâ”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”
        after: Optional['Node'] = self.nxt          #      â”‚    â”€â”€â”¼â”€â”€â”€â–º â”‚    â”€â”€â”¼â”€â”€â”€â–º â”‚    â”€â”€â”¼â”€â–º
        before: Optional['Node'] = self.prv         #   â—„â”€â”€â”¼â”€â”€    â”‚ â—„â”€â”€â”€â”¼â”€â”€    â”‚ â—„â”€â”€â”€â”¼â”€â”€    â”‚
        if after is not None:                       #      â”‚beforeâ”‚     â”‚self  â”‚     â”‚after â”‚
            after.prv = before                      #      â””â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”˜
        if before is not None:                      #                    â†“ â†“ â†“
            before.nxt = after                      #      â”Œâ”€â”€â”€â”€â”€â”€â”                  â”Œâ”€â”€â”€â”€â”€â”€â”
        self.prv, self.nxt = None, None             #      â”‚    â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â”‚    â”€â”€â”¼â”€â–º
        return after if before is None else None    #   â—„â”€â”€â”¼â”€â”€    â”‚ â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€    â”‚
                                                    #      â”‚beforeâ”‚                  â”‚after â”‚
        # if 'self' is a last (tail) node           #      â””â”€â”€â”€â”€â”€â”€â”˜     â”Œâ”€â”€â”€â”€â”€â”€â”     â””â”€â”€â”€â”€â”€â”€â”˜
        # return 'after' node as a new_tail         #                   â”‚    â”€â”€â”¼â”€â”€â–º
                                                    #               â—„â”€â”€â”€â”¼â”€â”€    â”‚
                                                    #                   â”‚self  â”‚
                                                    #                   â””â”€â”€â”€â”€â”€â”€â”˜
                                                    ####################################################################

    def push_forward(self, other: 'Node') -> None:  #           â”Œâ”€â”€â”€â”€â”€â”€â”
        after: Optional['Node'] = self.nxt          #           â”‚    â”€â”€â”¼â”€â–º
        if after is not None:                       #         â—„â”€â”¼â”€â”€    â”‚
            after.prv = other                       #           â”‚other â”‚
        other.prv, other.nxt = self, self.nxt       #           â””â”€â”€â”€â”€â”€â”€â”˜
        self.nxt = other                            #    â”Œâ”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”
                                                    #    â”‚    â”€â”€â”¼â”€â”€â”€â–º â”‚    â”€â”€â”¼â”€â–º
                                                    #  â—„â”€â”¼â”€â”€    â”‚ â—„â”€â”€â”€â”¼â”€â”€    â”‚
                                                    #    â”‚self  â”‚     â”‚after â”‚
                                                    #    â””â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”˜
                                                    #            â†“ â†“ â†“
                                                    #    â”Œâ”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”
                                                    #    â”‚    â”€â”€â”¼â”€â”€â”€â–º â”‚    â”€â”€â”¼â”€â”€â–º â”‚    â”€â”€â”¼â”€â–º
                                                    #  â—„â”€â”¼â”€â”€    â”‚ â—„â”€â”€â”€â”¼â”€â”€    â”‚ â—„â”€â”€â”¼â”€â”€    â”‚
                                                    #    â”‚self  â”‚     â”‚other â”‚    â”‚after â”‚
                                                    #    â””â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”˜
                                                    ####################################################################

    def push_backward(self, other: 'Node') -> None: #           â”Œâ”€â”€â”€â”€â”€â”€â”
        before: Optional['Node'] = self.prv         #           â”‚    â”€â”€â”¼â”€â–º
        if before is not None:                      #         â—„â”€â”¼â”€â”€    â”‚
            before.nxt = other                      #           â”‚other â”‚
        other.prv, other.nxt = self.prv, self       #           â””â”€â”€â”€â”€â”€â”€â”˜
        self.prv = other                            #    â”Œâ”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”
                                                    #    â”‚    â”€â”€â”¼â”€â”€â”€â–º â”‚    â”€â”€â”¼â”€â–º
                                                    #  â—„â”€â”¼â”€â”€    â”‚ â—„â”€â”€â”€â”¼â”€â”€    â”‚
                                                    #    â”‚beforeâ”‚     â”‚self  â”‚
                                                    #    â””â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”˜
                                                    #            â†“ â†“ â†“
                                                    #    â”Œâ”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”
                                                    #    â”‚    â”€â”€â”¼â”€â”€â”€â–º â”‚    â”€â”€â”¼â”€â”€â–º â”‚    â”€â”€â”¼â”€â–º
                                                    #  â—„â”€â”¼â”€â”€    â”‚ â—„â”€â”€â”€â”¼â”€â”€    â”‚ â—„â”€â”€â”¼â”€â”€    â”‚
                                                    #    â”‚beforeâ”‚     â”‚other â”‚    â”‚self  â”‚
                                                    #    â””â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”˜
                                                    ####################################################################


''' Graphic for "class LFUCache"

ket2node dict
         {
           g: â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           f: â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
           e: â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚            â”‚
           d: â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚            â”‚            â”‚
           c: â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚            â”‚            â”‚            â”‚
           b: â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚            â”‚            â”‚            â”‚            â”‚
           a: â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚            â”‚            â”‚            â”‚            â”‚            â”‚
         }            â”‚            â”‚            â”‚            â”‚            â”‚            â”‚            â”‚
                      â–¼            â–¼            â–¼            â–¼            â–¼            â–¼            â–¼
                   â”Œâ”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”
tail â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â”‚cnt: 1â”‚     â”‚cnt: 1â”‚     â”‚cnt: 2â”‚     â”‚cnt: 2â”‚     â”‚cnt: 2â”‚     â”‚cnt: 3â”‚     â”‚cnt: 3â”‚
                   â”‚key: aâ”‚     â”‚key: bâ”‚     â”‚key: câ”‚     â”‚key: dâ”‚     â”‚key: eâ”‚     â”‚key: fâ”‚     â”‚key: gâ”‚
                   â”‚val   â”‚     â”‚val   â”‚     â”‚val   â”‚     â”‚val   â”‚     â”‚val   â”‚     â”‚val   â”‚     â”‚val   â”‚
                   â”‚    â”€â”€â”¼â”€â”€â”€â–º â”‚    â”€â”€â”¼â”€â”€â”€â–º â”‚    â”€â”€â”¼â”€â”€â”€â–º â”‚    â”€â”€â”¼â”€â”€â”€â–º â”‚    â”€â”€â”¼â”€â”€â”€â–º â”‚    â”€â”€â”¼â”€â”€â”€â–º â”‚    â”€â”€â”¼â”€â–º
                â—„â”€â”€â”¼â”€â”€    â”‚ â—„â”€â”€â”€â”¼â”€â”€    â”‚ â—„â”€â”€â”€â”¼â”€â”€    â”‚ â—„â”€â”€â”€â”¼â”€â”€    â”‚ â—„â”€â”€â”€â”¼â”€â”€    â”‚ â—„â”€â”€â”€â”¼â”€â”€    â”‚ â—„â”€â”€â”€â”¼â”€â”€    â”‚
                   â”‚      â”‚     â”‚      â”‚     â”‚      â”‚     â”‚      â”‚     â”‚      â”‚     â”‚      â”‚     â”‚      â”‚
                   â””â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”˜
                                   â–²                                      â–²                         â–²
count2last dict                    â”‚                                      â”‚                         â”‚
         {                         â”‚                                      â”‚                         â”‚
           1: â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                      â”‚                         â”‚
           2: â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â”‚
           3: â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         }
'''


class LFUCache:

    def __init__(self, capacity: int):
        self._limit:        int = capacity
        self._len:          int = 0
        self.tail:          Optional[Node] = None
        self.key2node:      dict[int, Node] = dict()
        self.cnt2last:    dict[int, Node] = dict()

    def debug(self):
        cur = self.tail
        while cur is not None:
            print(f'ðŸ”‘:{cur.key}', f'ðŸ“¦:{cur.val}', f'â²ï¸:{cur.cnt}', ' > ', end='')
            cur = cur.nxt
        print()

    def _pop_n_tail(self, trg: Node):
        """part_of 'def incm'"""
        if (new_tail := trg.pop()) is not None:
            self.tail = new_tail

    def _update_count(self, trg: Node):
        """part_of 'def incm'"""
        self.cnt2last[trg.cnt + 1] = trg
        trg.cnt += 1

    def _replace_count(self, trg: Node):
        """part_of 'def incm'"""
        if trg.prv is None or trg.prv.cnt != trg.cnt:
            del self.cnt2last[trg.cnt]
            return
        self.cnt2last[trg.cnt] = trg.prv

    def incm(self, trg: Node) -> None:
        """increment a counter for a target node"""
        if self.cnt2last.get(trg.cnt) is not trg:       # trg â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            last = self.cnt2last.get(trg.cnt + 1, None) #                      â–¼
            if last is None:                            #      â”Œâ”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”
                last = self.cnt2last.get(trg.cnt)       #      â”‚cnt: 2â”‚     â”‚cnt: 2â”‚     â”‚cnt: 2â”‚     â”‚cnt: 3â”‚     â”‚cnt: 3â”‚
            self._pop_n_tail(trg)                       #      â”‚key: aâ”‚     â”‚key: bâ”‚     â”‚key: câ”‚     â”‚key: dâ”‚     â”‚key: fâ”‚
            last.push_forward(trg)                      #      â”‚val   â”‚     â”‚val   â”‚     â”‚val   â”‚     â”‚val   â”‚     â”‚val   â”‚
            self._update_count(trg)                     #      â”‚    â”€â”€â”¼â”€â”€â”€â–º â”‚    â”€â”€â”¼â”€â”€â”€â–º â”‚    â”€â”€â”¼â”€â”€â”€â–º â”‚    â”€â”€â”¼â”€â”€â”€â–º â”‚    â”€â”€â”¼â”€â–º
            return                                      #  â—„â”€â”€â”€â”¼â”€â”€    â”‚ â—„â”€â”€â”€â”¼â”€â”€    â”‚ â—„â”€â”€â”€â”¼â”€â”€    â”‚ â—„â”€â”€â”€â”¼â”€â”€    â”‚ â—„â”€â”€â”€â”¼â”€â”€    â”‚
                                                        #      â”‚      â”‚     â”‚targetâ”‚     â”‚      â”‚     â”‚      â”‚     â”‚      â”‚
                                                        #      â””â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”˜
                                                        #                                   â–²                         â–²
                                                        # count2last                        â”‚                         â”‚
                                                        # {                                 â”‚                         â”‚
                                                        #  2: â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â”‚
                                                        #  3: â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                        # }
                                                        #                     â†“ â†“ â†“
                                                        #
                                                        # trg â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                                        #                                                                          â–¼
                                                        #      â”Œâ”€â”€â”€â”€â”€â”€â”                  â”Œâ”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”
                                                        #      â”‚cnt: 2â”‚                  â”‚cnt: 2â”‚     â”‚cnt: 3â”‚     â”‚cnt: 3â”‚     â”‚cnt: 3â”‚
                                                        #      â”‚key: aâ”‚                  â”‚key: câ”‚     â”‚key: dâ”‚     â”‚key: fâ”‚     â”‚key: bâ”‚
                                                        #      â”‚val   â”‚                  â”‚val   â”‚     â”‚val   â”‚     â”‚val   â”‚     â”‚val   â”‚
                                                        #      â”‚    â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º  â”‚    â”€â”€â”¼â”€â”€â”€â–º â”‚    â”€â”€â”¼â”€â”€â”€â–º â”‚    â”€â”€â”¼â”€â”€â”€â–º â”‚    â”€â”€â”¼â”€â–º
                                                        #  â—„â”€â”€â”€â”¼â”€â”€    â”‚  â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€    â”‚ â—„â”€â”€â”€â”¼â”€â”€    â”‚ â—„â”€â”€â”€â”¼â”€â”€    â”‚ â—„â”€â”€â”€â”¼â”€â”€    â”‚
                                                        #      â”‚      â”‚                  â”‚      â”‚     â”‚      â”‚     â”‚      â”‚     â”‚targetâ”‚
                                                        #      â””â”€â”€â”€â”€â”€â”€â”˜                  â””â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”˜
                                                        #                                   â–²                                      â–²
                                                        # count2last                        â”‚                                      â”‚
                                                        # {                                 â”‚                                      â”‚
                                                        #  2: â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                      â”‚
                                                        #  3: â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                        # }

        if self.cnt2last.get(trg.cnt + 1, None):        # trg â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            self._replace_count(trg)                    #                                   â–¼
            self._pop_n_tail(trg)                       #      â”Œâ”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”
            last = self.cnt2last.get(trg.cnt + 1)       #      â”‚cnt: 2â”‚     â”‚cnt: 2â”‚     â”‚cnt: 2â”‚     â”‚cnt: 3â”‚     â”‚cnt: 3â”‚
            last.push_forward(trg)                      #      â”‚key: aâ”‚     â”‚key: bâ”‚     â”‚key: câ”‚     â”‚key: dâ”‚     â”‚key: fâ”‚
            self._update_count(trg)                     #      â”‚val   â”‚     â”‚val   â”‚     â”‚val   â”‚     â”‚val   â”‚     â”‚val   â”‚
            return                                      #      â”‚    â”€â”€â”¼â”€â”€â”€â–º â”‚    â”€â”€â”¼â”€â”€â”€â–º â”‚    â”€â”€â”¼â”€â”€â”€â–º â”‚    â”€â”€â”¼â”€â”€â”€â–º â”‚    â”€â”€â”¼â”€â–º
                                                        #  â—„â”€â”€â”€â”¼â”€â”€    â”‚ â—„â”€â”€â”€â”¼â”€â”€    â”‚ â—„â”€â”€â”€â”¼â”€â”€    â”‚ â—„â”€â”€â”€â”¼â”€â”€    â”‚ â—„â”€â”€â”€â”¼â”€â”€    â”‚
                                                        #      â”‚      â”‚     â”‚      â”‚     â”‚targetâ”‚     â”‚      â”‚     â”‚      â”‚
                                                        #      â””â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”˜
                                                        #                                   â–²                         â–²
                                                        # count2last                        â”‚                         â”‚
                                                        # {                                 â”‚                         â”‚
                                                        #  2: â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â”‚
                                                        #  3: â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                        # }
                                                        #                     â†“ â†“ â†“
                                                        #
                                                        # trg â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                                        #                                                                          â–¼
                                                        #      â”Œâ”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”                  â”Œâ”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”
                                                        #      â”‚cnt: 2â”‚     â”‚cnt: 2â”‚                  â”‚cnt: 3â”‚     â”‚cnt: 3â”‚     â”‚cnt: 3â”‚
                                                        #      â”‚key: aâ”‚     â”‚key: bâ”‚                  â”‚key: dâ”‚     â”‚key: fâ”‚     â”‚key: câ”‚
                                                        #      â”‚val   â”‚     â”‚val   â”‚                  â”‚val   â”‚     â”‚val   â”‚     â”‚val   â”‚
                                                        #      â”‚    â”€â”€â”¼â”€â”€â”€â–º â”‚    â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º  â”‚    â”€â”€â”¼â”€â”€â”€â–º â”‚    â”€â”€â”¼â”€â”€â”€â–º â”‚    â”€â”€â”¼â”€â–º
                                                        #  â—„â”€â”€â”€â”¼â”€â”€    â”‚ â—„â”€â”€â”€â”¼â”€â”€    â”‚ â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€    â”‚ â—„â”€â”€â”€â”¼â”€â”€    â”‚ â—„â”€â”€â”€â”¼â”€â”€    â”‚
                                                        #      â”‚      â”‚     â”‚      â”‚                  â”‚      â”‚     â”‚      â”‚     â”‚targetâ”‚
                                                        #      â””â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”˜                  â””â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”˜
                                                        #                      â–²                                                   â–²
                                                        # count2last           â”‚                                                   â”‚
                                                        # {                    â”‚                                                   â”‚
                                                        #  2: â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                   â”‚
                                                        #  3: â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                        # }

        self._replace_count(trg)                        # trg â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        self._update_count(trg)                         #                                   â–¼
        return                                          #      â”Œâ”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”
                                                        #      â”‚cnt: 2â”‚     â”‚cnt: 2â”‚     â”‚cnt: 2â”‚     â”‚cnt: 4â”‚     â”‚cnt: 4â”‚
                                                        #      â”‚key: aâ”‚     â”‚key: bâ”‚     â”‚key: câ”‚     â”‚key: dâ”‚     â”‚key: fâ”‚
                                                        #      â”‚val   â”‚     â”‚val   â”‚     â”‚val   â”‚     â”‚val   â”‚     â”‚val   â”‚
                                                        #      â”‚    â”€â”€â”¼â”€â”€â”€â–º â”‚    â”€â”€â”¼â”€â”€â”€â–º â”‚    â”€â”€â”¼â”€â”€â”€â–º â”‚    â”€â”€â”¼â”€â”€â”€â–º â”‚    â”€â”€â”¼â”€â–º
                                                        #  â—„â”€â”€â”€â”¼â”€â”€    â”‚ â—„â”€â”€â”€â”¼â”€â”€    â”‚ â—„â”€â”€â”€â”¼â”€â”€    â”‚ â—„â”€â”€â”€â”¼â”€â”€    â”‚ â—„â”€â”€â”€â”¼â”€â”€    â”‚
                                                        #      â”‚      â”‚     â”‚      â”‚     â”‚targetâ”‚     â”‚      â”‚     â”‚      â”‚
                                                        #      â””â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”˜
                                                        #                                   â–²                         â–²
                                                        # count2last                        â”‚                         â”‚
                                                        # {                                 â”‚                         â”‚
                                                        #  2: â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â”‚
                                                        #  3:                                                         â”‚
                                                        #  4: â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                        # }
                                                        #                     â†“ â†“ â†“
                                                        #
                                                        # trg â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                                        #                                   â–¼
                                                        #      â”Œâ”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”
                                                        #      â”‚cnt: 2â”‚     â”‚cnt: 2â”‚     â”‚cnt: 3â”‚     â”‚cnt: 4â”‚     â”‚cnt: 4â”‚
                                                        #      â”‚key: aâ”‚     â”‚key: bâ”‚     â”‚key: câ”‚     â”‚key: dâ”‚     â”‚key: câ”‚
                                                        #      â”‚val   â”‚     â”‚val   â”‚     â”‚val   â”‚     â”‚val   â”‚     â”‚val   â”‚
                                                        #      â”‚    â”€â”€â”¼â”€â”€â”€â–º â”‚    â”€â”€â”¼â”€â”€â”€â–º â”‚    â”€â”€â”¼â”€â”€â”€â–º â”‚    â”€â”€â”¼â”€â”€â”€â–º â”‚    â”€â”€â”¼â”€â–º
                                                        #  â—„â”€â”€â”€â”¼â”€â”€    â”‚ â—„â”€â”€â”€â”¼â”€â”€    â”‚ â—„â”€â”€â”€â”¼â”€â”€    â”‚ â—„â”€â”€â”€â”¼â”€â”€    â”‚ â—„â”€â”€â”€â”¼â”€â”€    â”‚
                                                        #      â”‚      â”‚     â”‚      â”‚     â”‚targetâ”‚     â”‚      â”‚     â”‚      â”‚
                                                        #      â””â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”˜
                                                        #                      â–²            â–²                         â–²
                                                        # count2last           â”‚            â”‚                         â”‚
                                                        # {                    â”‚            â”‚                         â”‚
                                                        #  2: â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚                         â”‚
                                                        #  3: â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â”‚
                                                        #  4: â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                        # }

    def get(self, key: int) -> int:
        if (trg := self.key2node.get(key, None)) is None:
            return -1
        self.incm(trg)
        return trg.val

    def _put_remove_lfu(self):
        if self.cnt2last.get(self.tail.cnt) is self.tail:
            del self.cnt2last[self.tail.cnt]
        del self.key2node[self.tail.key]
        new_tail = self.tail.pop()
        self.tail = new_tail

    def put(self, key: int, value: int) -> None:
        if self._limit == 0:
            return
        if (trg := self.key2node.get(key, None)) is not None:
            self.incm(trg)
            trg.val = value
            return
        if self._len < self._limit:
            self._len += 1
        else:
            self._put_remove_lfu()

        if (last := self.cnt2last.get(1, None)) is not None:
            tmp = Node(key=key, val=value, cnt=1)
            last.push_forward(tmp)
            self.cnt2last[1], self.key2node[key] = tmp, tmp
            return

        tmp = Node(key=key, val=value, cnt=1)
        self.cnt2last[1], self.key2node[key] = tmp, tmp
        if self.tail is not None:
            self.tail.push_backward(tmp)
        self.tail = tmp


if __name__ == '__main__':
    time_diff = -time.perf_counter()
    a = ["LFUCache", "put", "put", "get", "put", "get", "get", "put", "get", "get", "get"]
    b = [[2], [1, 1], [2, 2], [1], [3, 3], [2], [3], [4, 4], [1], [3], [4]]

    foo = LFUCache(*b[0])
    for el_a, el_b in zip(a[1:], b[1:]):
        print()
        print(el_a, el_b)
        print(getattr(foo, el_a)(*el_b))
        #foo.debug()

    time_diff += time.perf_counter()
    print('â± ï¸', time_diff)
